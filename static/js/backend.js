var sb=(()=>{var d=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var w=(o,t)=>{for(var e in t)d(o,e,{get:t[e],enumerable:!0})},x=(o,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of p(t))!y.call(o,r)&&r!==e&&d(o,r,{get:()=>t[r],enumerable:!(s=u(t,r))||s.enumerable});return o};var b=o=>x(d({},"__esModule",{value:!0}),o);var n=(o,t,e)=>new Promise((s,r)=>{var i=a=>{try{l(e.next(a))}catch(h){r(h)}},c=a=>{try{l(e.throw(a))}catch(h){r(h)}},l=a=>a.done?s(a.value):Promise.resolve(a.value).then(i,c);l((e=e.apply(o,t)).next())});var k={};w(k,{Backend:()=>g});var g=class{constructor(t,e){this.baseURL="https://na1.staticbackend.com";this.wsURL="wss://na1.staticbackend.com";this.ws=null;this.wsId=null;this.wsToken=null;this.sseClient=null;this.pubKey="";this.types={ok:"ok",error:"error",init:"init",token:"token",joined:"joined",chanOut:"chan_out",dbCreated:"db_created",dbUpdated:"db_updated",dbDeleted:"db_deleted",echo:"echo",auth:"auth",join:"join",chanIn:"chan_in",presence:"presence"};this.timeout=t=>new Promise(e=>setTimeout(e,t));this.pubKey=t,e&&(e=="dev"?(this.baseURL="http://localhost:8099",this.wsURL="ws://localhost:8099"):e.length<10?(this.baseURL=`https://${e}.staticbackend.com`,this.wsURL=`wss://${e}.staticbackend.com`):(this.baseURL=e,this.wsURL=e.replace("https","wss")))}rawreq(t,e,s,r,i){return n(this,null,function*(){try{let l=null;i&&(l=t=="application/json"?JSON.stringify(i):i);let a={"SB-PUBLIC-KEY":this.pubKey};t&&t.length&&(a["Content-Type"]=t),e&&(a.Authorization=`Bearer ${e}`);let h=yield fetch(`${this.baseURL}${r}`,{method:s,headers:a,body:l});var c=null;return h.status>299?(c=yield h.text(),{ok:!1,content:c}):(c=yield h.json(),{ok:!0,content:c})}catch(l){return console.error(l),{ok:!1,content:l}}})}req(t,e,s,r){return n(this,null,function*(){return yield this.rawreq("application/json",t,e,s,r)})}register(t,e){return n(this,null,function*(){let s={email:t,password:e};return yield this.req("","POST","/register",s)})}login(t,e){return n(this,null,function*(){let s={email:t,password:e};return yield this.req("","POST","/login",s)})}me(t){return n(this,null,function*(){return yield this.req(t,"GET","/me")})}create(t,e,s){return n(this,null,function*(){return yield this.req(t,"POST",`/db/${e}`,s)})}createBulk(t,e,s){return n(this,null,function*(){return yield this.req(t,"POST",`/db/${e}?bulk=1`,s)})}list(t,e){return n(this,null,function*(){return yield this.req(t,"GET",`/db/${e}`)})}getById(t,e,s){return n(this,null,function*(){return yield this.req(t,"GET",`/db/${e}/${s}`)})}query(t,e,s){return n(this,null,function*(){return yield this.req(t,"POST",`/query/${e}`,s)})}update(t,e,s,r){return n(this,null,function*(){return yield this.req(t,"PUT",`/db/${e}/${s}`,r)})}updateBulk(t,e,s){return n(this,null,function*(){return yield this.req(t,"PUT",`/db/${e}?bulk=1`,s)})}delete(t,e,s){return n(this,null,function*(){return yield this.req(t,"DELETE",`/db/${e}/${s}`)})}deleteBulk(t,e,s){return n(this,null,function*(){let r=btoa(JSON.stringify(s));return yield this.req(t,"DELETE",`/db/${e}?bulk=1&x=${r}`)})}count(t,e,s){return n(this,null,function*(){return yield this.req(t,"POST",`/db/count/${e}`,s)})}search(t,e,s){return n(this,null,function*(){let r={col:e,keywords:s};return yield this.req(t,"POST","/search",r)})}storeFile(t,e){return n(this,null,function*(){let s=new FormData(e);return yield this.rawreq("",t,"POST","/storage/upload",s)})}resizeImage(t,e,s){return n(this,null,function*(){let r=new FormData(s);return r.append("width",e.toString()),yield this.rawreq("",t,"POST","/extra/resizeimg",r)})}convertURLToX(t,e){return n(this,null,function*(){return yield this.req(t,"POST","/extra/htmltox",e)})}connectWS(t,e,s){this.ws=new WebSocket(this.wsURL+"/ws"),this.ws.onerror=r=>{console.error(r)},this.ws.onmessage=r=>{try{let i=JSON.parse(r.data);i.type==this.types.init?(this.wsId=i.data,this.send(this.types.auth,t)):i.type==this.types.token?(this.wsToken=i.data,e(i.data)):s(i)}catch(i){console.error(i)}}}sendWS(t,e,s){if(this.ws==null)return!1;let r={sid:this.wsId,token:this.wsToken,type:t,data:e,channel:s};return this.ws.send(JSON.stringify(r)),!0}connect(t,e,s){this.sseClient=new EventSource(this.baseURL+`/sse/connect?sbpk=${this.pubKey}`),this.sseClient.onerror=r=>{console.error(r)},this.sseClient.onmessage=r=>{try{let i=JSON.parse(r.data);i.type==this.types.init?(this.wsId=i.data,this.wsToken=t,this.send(this.types.auth,t)):i.type==this.types.token?e(this.wsToken):s(i)}catch(i){console.error(i)}}}send(t,e,s){if(this.sseClient==null||this.sseClient.readyState==2)return!1;let r={sid:this.wsId,token:this.wsToken,type:t,data:e,channel:s};return n(this,null,function*(){return yield this.req(this.wsToken,"POST","/sse/msg",r)}),!0}generateId(){let t=new Date().getTime();return"R"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){let r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?r:r&3|8).toString(16)})}socialLogin(t){return n(this,null,function*(){let e=this.generateId(),s=`${this.baseURL}/oauth/login?provider=${t}&reqid=${e}&sbpk=${this.pubKey}`;return window.open(s,"_blank"),yield this.checkExternalUser(1,e)})}checkExternalUser(t,e){return n(this,null,function*(){if(t>=950)return{token:"",email:"",name:"",first:"",last:"",avatarUrl:""};let s=yield this.req("","GET",`/oauth/get-user?reqid=${e}`);return!s.ok||!s.content?(t++,yield this.timeout(1750),yield this.checkExternalUser(t,e)):s.content})}};return b(k);})();
